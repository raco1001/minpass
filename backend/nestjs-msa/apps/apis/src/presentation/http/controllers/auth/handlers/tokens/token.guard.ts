/**
 * ============================================================================
 * ğŸ¯ í† í° ê²€ì¦ ë° ì‚¬ìš©ì ID ì¶”ì¶œ ì „ëµ (Token Extraction & Validation Strategy)
 * ============================================================================
 *
 * ### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œì˜ ì¶”ì²œ ì „ëµ: "Multi-Layer Validation"
 *
 * ğŸ“Œ ì„ íƒí•œ ì „ëµ: Guardì—ì„œëŠ” JWT ê²€ì¦ë§Œ + ì‹¤ì œ ì‚¬ìš©ì ì¡°íšŒëŠ” ê° ì„œë¹„ìŠ¤ì—ì„œ ì²˜ë¦¬
 *
 * ### 1ï¸âƒ£ Guardì˜ ì±…ì„ (ê°€ë³ê³  ë¹ ë¥¸ ê²€ì¦)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * âœ… JWT ì„œëª… ê²€ì¦
 * âœ… í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸
 * âœ… í† í° í˜•ì‹ ê²€ì¦
 * âœ… userId ì¶”ì¶œ ë° ê¸°ë³¸ í˜•ì‹ ê²€ì¦ (UUID, ìˆ«ì ë“±)
 * âœ… Request ê°ì²´ì— userId ì²¨ë¶€
 *
 * âŒ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ:
 * âŒ ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ DB ì¡°íšŒ
 * âŒ ì‚¬ìš©ì ê¶Œí•œ/ì—­í•  í™•ì¸
 * âŒ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í˜¸ì¶œ
 *
 * ### 2ï¸âƒ£ ì„œë¹„ìŠ¤ì—ì„œì˜ ì±…ì„ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ê° ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤ì—ì„œ:
 * âœ… Guardì—ì„œ ë°›ì€ userIdë¡œ ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸
 * âœ… ì‚¬ìš©ì ê¶Œí•œ/ì—­í•  ê²€ì¦
 * âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë§ëŠ” ì¶”ê°€ ê²€ì¦
 *
 * ### 3ï¸âƒ£ ì•„í‚¤í…ì²˜ ì¥ì 
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *
 * âœ… Guardê°€ ê°€ë²¼ì›€ â†’ ëª¨ë“  ìš”ì²­ì— ë¹ ë¥¸ ì‘ë‹µ
 * âœ… ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì›ì¹™ ì¤€ìˆ˜:
 *    - GuardëŠ” HTTP ê³„ì¸µì˜ ê¸°ë³¸ ê²€ì¦ë§Œ ë‹´ë‹¹
 *    - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ì€ ê° ì„œë¹„ìŠ¤ (gRPC)ì—ì„œ
 * âœ… ìºì‹± ìš©ì´: ì‚¬ìš©ì ì •ë³´ëŠ” ì„œë¹„ìŠ¤ì—ì„œ ìºì‹± ê°€ëŠ¥
 * âœ… í™•ì¥ ìš©ì´: ìƒˆë¡œìš´ ê²€ì¦ ê·œì¹™ì€ ê° ì„œë¹„ìŠ¤ì—ì„œ ë…ë¦½ì ìœ¼ë¡œ ì¶”ê°€
 * âœ… í…ŒìŠ¤íŠ¸ ìš©ì´: Guardì™€ ì„œë¹„ìŠ¤ ë¡œì§ì´ ë¶„ë¦¬ë¨
 *
 * ### 4ï¸âƒ£ ë‹¨ê³„ë³„ ìš”ì²­ ì²˜ë¦¬ íë¦„
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *
 * Client Request
 *      â†“
 * ğŸ“Œ Guard ê²€ì¦ (HTTP ê³„ì¸µ)
 *      â”œâ”€ JWT ì„œëª… í™•ì¸
 *      â”œâ”€ ë§Œë£Œ ì‹œê°„ í™•ì¸
 *      â”œâ”€ userId ì¶”ì¶œ
 *      â””â”€ req.user = { userId, email, ... }
 *      â†“
 * Controller ìˆ˜ì‹ 
 *      â†“
 * ğŸ“Œ Service í˜¸ì¶œ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
 *      â”œâ”€ gRPCë¡œ Users ì„œë¹„ìŠ¤ì— ì‚¬ìš©ì ì¡°íšŒ
 *      â”œâ”€ ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸
 *      â”œâ”€ ê¶Œí•œ/ì—­í•  ê²€ì¦
 *      â””â”€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
 *      â†“
 * Response
 *
 * ### 5ï¸âƒ£ êµ¬í˜„ ì˜ˆì‹œ
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *
 * // 1ï¸âƒ£ Guard (HTTP ê²€ì¦ë§Œ)
 * @Injectable()
 * export class ExtractUserIdGuard implements CanActivate {
 *   async canActivate(context: ExecutionContext): Promise<boolean> {
 *     const request = context.switchToHttp().getRequest();
 *     const token = this.extractTokenFromRequest(request);
 *
 *     if (!token) {
 *       throw new UnauthorizedException('No token provided');
 *     }
 *
 *     try {
 *       const decoded = this.jwtService.verify(token);
 *       request.user = {
 *         userId: decoded.userId,
 *         email: decoded.email,
 *       };
 *       return true;
 *     } catch (error) {
 *       throw new UnauthorizedException('Invalid token');
 *     }
 *   }
 * }
 *
 * // 2ï¸âƒ£ Controllerì—ì„œ ì‚¬ìš©
 * @Get('me')
 * @UseGuards(ExtractUserIdGuard)
 * async getProfile(@Req() req: any) {
 *   const { userId } = req.user; // Guardì—ì„œ ì„¤ì •ë¨
 *   // ControllerëŠ” userIdë§Œ ë°›ìŒ
 *   return this.usersService.getUserProfile(userId);
 * }
 *
 * // 3ï¸âƒ£ Serviceì—ì„œ ê²€ì¦ (gRPC í˜¸ì¶œ)
 * async getUserProfile(userId: string) {
 *   // gRPCë¡œ users ì„œë¹„ìŠ¤ì— ìš”ì²­
 *   const user = await firstValueFrom(
 *     this.usersQuery.findOneUser({ id: userId })
 *   );
 *
 *   if (!user) {
 *     throw new NotFoundException('User not found');
 *   }
 *
 *   return user;
 * }
 *
 * ### 6ï¸âƒ£ ëŒ€ì•ˆ ë¹„êµ
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *
 * ì˜µì…˜ A) Guardì—ì„œ ì‚¬ìš©ì ì¡°íšŒê¹Œì§€ ì²˜ë¦¬
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ì¥ì :
 *   âœ… í•œ ë²ˆì— ëª¨ë“  ê²€ì¦ ì™„ë£Œ
 *   âœ… ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìëŠ” ë¹ ë¥´ê²Œ ì°¨ë‹¨
 *
 * ë‹¨ì :
 *   âŒ Guardê°€ ë¹„ëŒ€í•´ì§
 *   âŒ ëª¨ë“  ìš”ì²­ë§ˆë‹¤ gRPC í˜¸ì¶œ (ì„±ëŠ¥ ì €í•˜)
 *   âŒ ìºì‹±ì´ ë³µì¡í•´ì§
 *   âŒ Guardê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì˜ì¡´ (ëŠìŠ¨í•œ ê²°í•© ìœ„ë°˜)
 *   âŒ í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€
 *
 * ì˜µì…˜ B) Guardì—ì„œë§Œ í† í° ê²€ì¦
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ì¥ì :
 *   âœ… Guardê°€ ê°€ë³ê³  ë¹ ë¦„
 *   âœ… ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì›ì¹™ ì¤€ìˆ˜
 *   âœ… ê° ì„œë¹„ìŠ¤ê°€ ìì‹ ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ (ì‘ì§‘ë„ ë†’ìŒ)
 *   âœ… ìºì‹± ìš©ì´
 *   âœ… í…ŒìŠ¤íŠ¸ ì‰¬ì›€
 *
 * ë‹¨ì :
 *   âš ï¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í˜¸ì¶œì´ ë§ì•„ì§ˆ ìˆ˜ ìˆìŒ (í•˜ì§€ë§Œ ìºì‹±ìœ¼ë¡œ í•´ê²° ê°€ëŠ¥)
 *
 * ğŸ¯ ê²°ë¡ : ì˜µì…˜ B ì¶”ì²œ
 *
 * ### 7ï¸âƒ£ ì„±ëŠ¥ ìµœì í™” ì „ëµ
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *
 * ë§Œì•½ gRPC í˜¸ì¶œì´ ì„±ëŠ¥ ë¬¸ì œê°€ ë  ê²½ìš°:
 *
 * 1. Redis ìºì‹±
 *    const user = await this.cache.get(`user:${userId}`);
 *    if (!user) {
 *      user = await firstValueFrom(this.usersQuery.findOneUser({ id: userId }));
 *      await this.cache.set(`user:${userId}`, user, 3600); // 1ì‹œê°„ ìºì‹±
 *    }
 *
 * 2. ë°°ì¹˜ ì¡°íšŒ
 *    // ì—¬ëŸ¬ ì‚¬ìš©ìë¥¼ í•œ ë²ˆì— ì¡°íšŒ
 *    const users = await this.usersQuery.findByIds(userIds);
 *
 * 3. ì •ë³´ ë™ê¸°í™”
 *    // Auth ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©ì ì •ë³´ ë¡œì»¬ ë³µì‚¬ë³¸ ìœ ì§€
 *    // ì •ê¸°ì ìœ¼ë¡œ ë™ê¸°í™”
 *
 * ### 8ï¸âƒ£ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *
 * âœ… JWT í† í° êµ¬ì¡° í™•ì¸ (payloadì— userId, email í¬í•¨)
 * âœ… Guard êµ¬í˜„ (JWT ê²€ì¦, userId ì¶”ì¶œ)
 * âœ… Decorator ë§Œë“¤ê¸° (@ExtractUserId ë˜ëŠ” @Auth)
 * âœ… Controllerì— ì ìš©
 * âœ… Serviceì—ì„œ gRPC í˜¸ì¶œë¡œ ì‚¬ìš©ì ì¡°íšŒ
 * âœ… ì—ëŸ¬ ì²˜ë¦¬ (401 Unauthorized, 404 Not Found)
 * âœ… í…ŒìŠ¤íŠ¸ ì‘ì„±
 * âœ… ë¡œê¹… ì¶”ê°€ (ë³´ì•ˆìƒ userIdë§Œ, í† í°ì€ ë¡œê¹…í•˜ì§€ ë§ ê²ƒ)
 *
 * ============================================================================
 */

// êµ¬í˜„ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.
// ì•„ë˜ íŒŒì¼ ì°¸ê³ :
// - apps/apis/src/infrastructure/auth/extract-user-id.guard.ts
// - apps/apis/src/infrastructure/auth/decorators/extract-user-id.decorator.ts
